<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="with=device-width, inirial-scale=1.0">

    <title> 20) Promise nel dettaglio</title>

    <style>

    </style>

</head>

<body>
    <!--
        1) Cosa sono le promise
        2) Il problema con le callback
        3) Il miglioramento tramite promise
        4) Sintassi delle promise
        5) Risposta in caso di fallimento
        6) Chaining
        7) Costruire promise custom
        8) Rifiutare una promise custom
     -->

    <script>

        /* MIGLIORAMENTO DI UNA PROMISE

        chooseToppings()
            .then(toppings => {
                return placeOrder(toppings);
            })
            .then(order => {
                return collectOrder(order);
            })
            .then(pizza => eatPizza(pizza))
            .catch(failureCallback);
         */

        /* fetch('coffee.jpg')
            .then(response => {

                // if (!response.ok) {
                //    throw new Error(`HTTP error! status: ${response.status}`);
                //} else {
                //    return response.blob();
                //} 

                return response.blob();
            })
            .then(myBlob => {
                let objectURL = URL.createObjectURL(myBlob);
                let image = document.createElement('img');
                image.src = objectURL;
                document.body.appendChild(image);
            })
            .catch(e => {
                console.log('There has been a problem with your fetch operation: ' + e.message);
            });  */


        /* let timeoutPromise = new Promise((resolve, reject) => {
            setTimeout(function () {
                resolve('Success!');
            }, 2000);
        }); */

        function timeoutPromise(message, interval) {
            return new Promise((resolve, reject) => {
                if (message === '' || typeof message !== 'string') {
                    reject('Message is empty or not a string');
                } else if (interval < 0 || typeof interval !== 'number') {
                    reject('Interval is negative or not a number');
                } else {
                    setTimeout(function () {
                        resolve(message);
                    }, interval);
                }
            });
        };

        timeoutPromise('Hello there!', 1000)
            .then(message => {
                alert(message);
            })
            .catch(e => {
                console.log('Error: ' + e);
            });

    </script>
</body>

</html>